#sqlite #kotlin #android

[[_ Rusz Głową Android. Programowanie aplikacji]]

>[!tip] SQLite w Androidzie
> Android trwale przechowuje dane, używając baz danych SQLite
> - baza danych SQLite jest zwyczajnym plikiem.
> - Jest zoptymalizowana pod kątem wykorzystania przez jednego użytkownika.
> - Jest stabilna i szybka.

## Gdzie jest przechowywana baza danych?
###### `/data/data/nazwa_pakietu_aplikacji/databases/nazwa_bazy_danych.db`

W katalogu aplikacji może być przechowywanych kilka baz danych. Każda baza składa się z:
- **pliku baz danych**:
	- jego nazwa to nazwa bazy,
	- to główny plik bazy danych, 
	- w nim przechowywane są wszystkie dane
- **plik magazynu** (*journal file*) :
	- jego nazwa to nazwa bazy danych z końcówką `-journal`
	- zawiera wszelkie zmiany wprowadzane w bazie danych
	- jeżeli wprowadzanie zmian napotka problemy, to Android skorzysta z informacji zapisanych w tym pliku, by odtworzyć ostatnio wprowadzone zmian


## Androidowe klasy związane z SQLite

>[!success] Pomocnik SQLite `SQLiteOpenHelper`
> Umożliwia 
> > tworzenie baz danych 
> > zarządzanie nimi
>  Pomocnika tworzymy poprzez rozszerzenie klasy `SQLiteOpenHelper`

>[!success] baza danych SQLite - `SQLiteDatabase`
>Obiekt klasy `SQLiteDatabase` zapewnia dostęp do bazy danych.
>To obiekt *connection*.

>[!success] Kursor - `Cursor`
>Obiekt klasy `Cursor` służy do:
>> odczytywania informacji z bazy danych
>> zapisywania informacji w bazie danych


>[!danger] ważne
>Bazy danych nie są przechowywane w tym samym katalogu, w którym jest umieszczony kod aplikacji. Dzięki temu można zainstalować nową wersję aplikacji, a informacje przechowywane w bazie będą bezpieczne


---------
# Zmiana aplikacji Coffein
[[7. Widoki list i adaptery]]

## pomocnik SQL-ite
będzie służył do:
- utworzenie bazy danych 
- utworzenie tabeli `Drink` i zapisanie w niej informacji o napojach.
czyli zastępujemy klasę `Drink` bazą danych
 
Klasa `SQLiteHelper` pomaga w tworzeniu i utrzymani baz danych SQLite:
- tworzenie baz danych
- zapewnianie dostępu do baz danych
- utrzymywanie bazy danych w doskonałym stanie (zmiana starej struktury bazy danych w nowiutką strukturę)


## tworzenie pomocnika
utwórz klasę dziedziczącą po `SQLiteOpenHelper`
	- przesłoń metodę `onCreate()`
		- jest wywoływana w momencie, gdy baza danych zostaje po raz pierwszy utworzona na urządzeniu - trzeba:
			- **określić nazwę bazy danych** (bez nazwy baza zostanie utworzona tylko w pamięci, a po zamknięciu zniknie),
			- **określić numer wersji bazy danych** - (to liczba całkowita, jej pierwszą wartością musi być `1`, pomocnik SQLite będzie używał tego numeru do okreśłania, czy bazę danych należy  zaktualizować )
		- powinna zawierać cały kod niezbędny do utworzenia tabeli bazy danych,
	- przesłoń metodę `onUpdate()`:
		- jest wywoływana, gdy trzeba zaktualizować bazę danych,
			- np. zmiany w tabelach już po utworzeniu bazy danych.


```kotlin
  
import android.content.Context  
import android.database.sqlite.SQLiteDatabase  
import android.database.sqlite.SQLiteOpenHelper  
  
class CoffeinaDatabaseHelper(  
context: Context) : SQLiteOpenHelper(context, DATABASE_NAME,  
null, DATABASE_VERSION  
) {  
  
companion object {  
private const val DATABASE_NAME = "CoffeinaDatabase.db"  
private const val DATABASE_VERSION = 1  
}  
  
override fun onCreate(db: SQLiteDatabase) {  
// Kod do utworzenia tabeli lub innych struktur bazodanowych  
}  
  
override fun onUpgrade(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) {  
// Kod do aktualizacji schematu bazy danych, jeśli zachodzi potrzeba  
}  
  
  
}
```



















